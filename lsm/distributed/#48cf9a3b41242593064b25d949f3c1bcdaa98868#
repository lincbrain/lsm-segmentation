import dask
from typing import Optional

import tensorflow as tf
from stardist.models import StarDist3D

from ome_zarr.io import parse_url
from ome_zarr.reader import Reader


def stream_zarr(url: str, scale: Optional[int] = 0):
    reader = Reader(parse_url(url))
    dask_data = list(reader())[0].data
    # select volume of given resolution (highest by default)
    vol_scale = dask_data[scale][0][0]
    return vol_scale


def normalize_vol(vol: dask.array):
    return (vol - vol.min()) / (vol.max() - vol.min())

def anystar_predict_chunk(vol)


gpu_devices = tf.config.experimental.list_physical_devices("GPU")
for device in gpu_devices:
    tf.config.experimental.set_memory_growth(device, enable=True)


if __name__ == "__main__":
    print(f"hello")
